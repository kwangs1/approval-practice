<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.approval">
	<resultMap id="approvalResult" type="approvalVO">
		<result property="appr_seq" column="appr_seq" />
		<result property="name" column="name" />
		<result property="id" column="id" />
		<result property="regdate" column="regdate" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="startdate" column="startdate" />
		<result property="enddate" column="enddate" />
		<result property="status" column="status" />
		<result property="docregno" column="docregno" />
		<result property="deptid" column="deptid" />
		<result property="deptname" column="deptname" />
	</resultMap>

<select id="getLatestReceiptsSeq" resultType="java.lang.String">
   SELECT 'APPROVAL' || to_char(sysdate, 'YYYYMMDD') || appr_seq.currval FROM DUAL
</select>


<insert id="apprWrite" parameterType="approvalVO"> 
	<selectKey keyProperty="appr_seq" resultType="String" order="BEFORE">
		select 'APPROVAL' || to_char(sysdate, 'YYYYMMDD') || APPR_SEQ.nextval from dual
	</selectKey>
	insert into approval
	values(#{appr_seq},#{name},#{id},to_char(sysdate,'YYYY/MM/DD HH24:MI:SS'),#{title},#{content},#{startdate},#{enddate},1,#{docregno},#{deptid},#{deptname})
</insert>

<select id="apprWaitList" resultType="approvalVO">
	select a.*,p.participant_seq, p.approvalstatus, p.approvaltype, p.id
		from  approval a, participant p
	where p.appr_seq = a.appr_seq
	and p.approvalstatus = 4098
	and p.approvaltype = 4
	and p.id = #{id}
	order by a.appr_seq desc
</select>

<select id="apprInfo" resultType="approvalVO" parameterType="String">
	select * from approval where appr_seq = #{appr_seq}
</select>

<update id="ApprovalUpdateStatus">
	update approval
	set status = 256
	where appr_seq = #{appr_seq}
</update>
</mapper>